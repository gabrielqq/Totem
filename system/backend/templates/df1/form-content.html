<div class="window for-tab-form">
    <h1>&m.var:title;</h1>

    <form action="javascript:void(0)">
        &m.var:inputs;
        <div role="action-bar">
          <m.if cond="'&m.var:method;' -eq- 'update'">
            <button id="bt-delete-form">Deletar</button>
          </m.if>
            <button id="bt-save-form">Save</button>
        </div>
    </form>

    <div class="clear"></div>
</div>

<script>
    $(function(){
        $("#bt-save-form").click(function(){
            $("form").submit();
            return false;
        });

        $("form").submit(function(e){

            if(e.cancelable === true) return false; // impede apertar enter e enviar o formulário

            $.post(
                "?action=save-form&form=&m.var:form;",
                $(this).closest("form").serialize(),
                function(data){
                    if( data.error ){
                        mesageConcat = 'Os seguintes erros ocorreram: \r\n';
                        $.each(data.message, function(key, val){
                            mesageConcat += "- "+val+"\r\n";
                        });
                        alert(mesageConcat);
                    }else{
                        if( window.opener ){
                            window.close();
                        }else{
                            window.location = "?action=view-update-form&form=&m.var:form;&id=" + data.result._M_PRIMARY_KEY_VALUE_;
                        }
                    }
                },
                "json"
            );

            return false;
        });
        
      <m.if cond="'&m.var:method;' -eq- 'update'">
        $("#bt-delete-form").click(function(){
            msg  = "ATENÇÃO!\r\n\r\n"
            msg += "- Você esta prestes a deletar este formulário, esta ação não pode ser desfeita, clique \r\n";
            msg += "em OK caso realmente deseja excluir estas informações ou clique em CANCELAR \r\n";
            msg += "para impedir a exclusão destes dados.";
            if( confirm(msg) ){
                $.post(
                    "?action=delete-form&form=&m.var:form;&id=&m.var:_GET.id;",
                    function(data){
                        if(data.error){
                            alert(data.message);
                        }else{
                            window.location = "?action=view-list-form&form=&m.var:form;";
                        }
                    },
                    "json"
                );
            }
            return false;
        });
      </m.if>

    });
</script>